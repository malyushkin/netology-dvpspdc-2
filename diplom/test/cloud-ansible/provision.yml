---

- hosts: nodes
  become: yes
  become_user: root
  remote_user: ubuntu

  tasks:
#    - name: Create directory for ssh-keys
#      file: state=directory mode=0700 dest=/root/.ssh/
#
#    - name: Adding rsa-key to /root/.ssh/authorized_keys
#      copy: src=~/.ssh/id_rsa.pub dest=/root/.ssh/authorized_keys owner=root mode=0600
#      ignore_errors: yes
#
#    - name: Update all packages
#      yum:
#        name: '*'
#        state: latest
#        update_cache: true
#
#    - name: Install base packages
#      yum:
#        name:
#          - bind-utils
#          - yum-utils
#          - curl
#          - epel-release
#          - nano
#        state: present
#        update_cache: true
#
#    - name: Check DNS
#      command: host -t A google.com
#
#    - name: Add docker repo
#      command: yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
#
#    - name: Install docker packages
#      yum:
#        name:
#          - docker-ce
#          - docker-ce-cli
#        state: present
#        update_cache: yes
#
#    - name: Enable docker daemon
#      systemd:
#        name: docker
#        state: started
#        enabled: yes
#
#    - name: Install docker-compose
#      raw: $(curl -L https://github.com/docker/compose/releases/download/1.29.2/docker-compose-`uname -s`-`uname -m` -o /usr/bin/docker-compose && chmod +x /usr/bin/docker-compose)

    - name: Install nginx packages
      yum:
        name:
          - nginx
        state: present
        update_cache: yes

    - name: Enable nginx daemon
      systemd:
        name: nginx
        state: started
        enabled: yes

#    - name: Synchronization
#      copy:
#        src: stack/
#        dest: "/opt/stack/"
#        owner: root
#        group: root
#        mode: 0644
#      become: true
#
#    - name: Pull all images in compose
#      command: docker-compose -f /opt/stack/docker-compose.yaml pull
#
#    - name: Up all services in compose
#      command: docker-compose -f /opt/stack/docker-compose.yaml up -d
